<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´…ç¶ ç‡ˆé£Ÿç‰©å¤§å†’éšª v5.0 (é—–é—œç‰ˆ)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
            font-family: 'Microsoft JhengHei', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }
        canvas {
            border: 4px solid #555;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
        }
        #ui-layer {
            margin-bottom: 15px;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 90%;
        }
        h2 { margin: 0 0 5px 0; color: #333; }
        .instructions { color: #555; font-size: 0.95em; line-height: 1.4; }
        .tag { padding: 2px 6px; border-radius: 4px; color: white; display: inline-block; margin: 0 2px; font-size: 0.8em;}
        .g-tag { background-color: #27ae60; }
        .y-tag { background-color: #f39c12; }
        .r-tag { background-color: #c0392b; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h2>ğŸš¦ ç´…ç¶ ç‡ˆé£Ÿç‰©å¤§å†’éšª</h2>
        <div class="instructions">
            <b>ç›®æ¨™ï¼š</b>åŠªåŠ›åƒç¶ ç‡ˆé£Ÿç‰©ï¼Œç´¯ç©ç©åˆ†é—–é—œï¼<br>
            <span class="tag g-tag">ç¶ ç‡ˆ</span>å¤šåƒ 
            <span class="tag y-tag">é»ƒç‡ˆ</span>é©é‡ 
            <span class="tag r-tag">ç´…ç‡ˆ</span>ä¸åƒ
        </div>
    </div>
    <canvas id="gameCanvas" width="800" height="450"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- 1. é£Ÿç‰©è³‡æ–™åº« ---
    const greenList = [
        {name:"ç³™ç±³é£¯", icon:"ğŸš"}, {name:"å…¨éº¥åå¸", icon:"ğŸ"}, {name:"é«˜éº—èœ", icon:"ğŸ¥¬"}, 
        {name:"è èœ", icon:"ğŸƒ"}, {name:"ç´…è˜¿è””", icon:"ğŸ¥•"}, {name:"ç•ªèŒ„", icon:"ğŸ…"}, 
        {name:"è˜‹æœ", icon:"ğŸ"}, {name:"é¦™è•‰", icon:"ğŸŒ"}, {name:"é›èƒ¸è‚‰", icon:"ğŸ—"}, 
        {name:"é­š", icon:"ğŸŸ"}, {name:"å°å·", icon:"ğŸ¦‘"}, {name:"é›è›‹", icon:"ğŸ¥š"}, 
        {name:"è±†å¹²", icon:"ğŸŸ«"}, {name:"ç„¡ç³–è±†æ¼¿", icon:"ğŸ¥›"}, {name:"é®®å¥¶", icon:"ğŸ¥›"}, 
        {name:"åœ°ç“œ", icon:"ğŸ "}, {name:"é¦¬éˆ´è–¯", icon:"ğŸ¥”"}, {name:"å°é»ƒç“œ", icon:"ğŸ¥’"}
    ];

    const yellowList = [
        {name:"100%æœæ±", icon:"ğŸ§ƒ"}, {name:"è˜‡æ‰“é¤…ä¹¾", icon:"ğŸª"}, {name:"é«˜çº–é¤…ä¹¾", icon:"ğŸª"},
        {name:"æµ·ç¶¿è›‹ç³•", icon:"ğŸ°"}, {name:"æ³¢ç¾…éºµåŒ…", icon:"ğŸ¥¯"}, {name:"é›è›‹ç³•", icon:"ğŸ§"},
        {name:"æ¼¢å ¡", icon:"ğŸ”"}, {name:"æŠ«è–©(æ™®)", icon:"ğŸ•"}, {name:"ç…è˜¿è””ç³•", icon:"â¬œ"},
        {name:"é›ç¿…è†€", icon:"ğŸ—"}, {name:"å…§è‡Ÿé¡", icon:"ğŸ«€"}, {name:"é­šä¸¸", icon:"ğŸ¡"},
        {name:"è²¢ä¸¸", icon:"ğŸ¡"}, {name:"è·åŒ…è›‹", icon:"ğŸ³"}, {name:"ç‚’è›‹", icon:"ğŸ³"},
        {name:"é¹¹è›‹", icon:"ğŸ¥š"}, {name:"çš®è›‹", icon:"ğŸ¥š"}, {name:"é­šé¬†", icon:"ğŸŸ"},
        {name:"è‚‰é¬†", icon:"ğŸ–"}, {name:"ç‰›è‚‰ä¹¾", icon:"ğŸ¥©"}, {name:"é­·é­šçµ²", icon:"ğŸ¦‘"},
        {name:"ç”œè±†èŠ±", icon:"ğŸ®"}
    ];

    const redList = [
        {name:"èµ·é…¥éºµåŒ…", icon:"ğŸ¥"}, {name:"æ²¹æ¢", icon:"ğŸ¥–"}, {name:"ä¸¹éº¥é…¥é¤…", icon:"ğŸª"},
        {name:"å¤¾å¿ƒé¤…ä¹¾", icon:"ğŸª"}, {name:"å°è¥¿é»", icon:"ğŸ§"}, {name:"é®®å¥¶æ²¹è›‹ç³•", icon:"ğŸ°"},
        {name:"èŠ‹æ³¥é¤…", icon:"ğŸ¥®"}, {name:"æ²™çªç‘ª", icon:"ğŸŸ«"}, {name:"ç”œç”œåœˆ", icon:"ğŸ©"},
        {name:"é›™èƒèƒ", icon:"ğŸ¥¨"}, {name:"æŠ«è–©(æ²¹)", icon:"ğŸ•"}, {name:"æ³¡éºµ", icon:"ğŸœ"},
        {name:"è‚¥è‚‰", icon:"ğŸ¥“"}, {name:"ä¸‰å±¤è‚‰", icon:"ğŸ¥“"}, {name:"ç‰›è…©", icon:"ğŸ¥©"},
        {name:"ç«è…¿", icon:"ğŸ–"}, {name:"ç†±ç‹—", icon:"ğŸŒ­"}, {name:"é­šè‚š", icon:"ğŸŸ"},
        {name:"è‚‰é†¬ç½é ­", icon:"ğŸ¥«"}, {name:"é¦™è…¸", icon:"ğŸŒ­"}, {name:"ç‚¸é›", icon:"ğŸ—"},
        {name:"é¹½é…¥é›", icon:"ğŸ—"}, {name:"é´¨çš®", icon:"ğŸ¦†"}, {name:"ç‚¸æ²¹è±†è…", icon:"ğŸŸ«"},
        {name:"æ´‹èŠ‹ç‰‡", icon:"ğŸ¥”"}, {name:"æ´¾", icon:"ğŸ¥§"}, {name:"ç³–æœ", icon:"ğŸ¬"},
        {name:"å·§å…‹åŠ›", icon:"ğŸ«"}, {name:"å†°æ£’", icon:"ğŸ§"}, {name:"ç”œç­’", icon:"ğŸ¦"},
        {name:"å†°æ·‡æ·‹è›‹ç³•", icon:"ğŸ‚"}
    ];

    // --- 2. é—œå¡è¨­å®š (é—–é—œæ ¸å¿ƒ) ---
    const levelConfig = [
        { 
            targetScore: 100, 
            speed: 4, 
            title: "Level 1: æ–°æ‰‹å‡ºç™¼", 
            msg: "åšå¾—å¥½ï¼å¤šé¸ã€Œç¶ ç‡ˆé£Ÿç‰©ã€\nèº«é«”è¼•ç›ˆï¼Œæ‰èƒ½è·³å¾—æ›´é«˜å–”ï¼" 
        },
        { 
            targetScore: 300, 
            speed: 5.5, 
            title: "Level 2: ç¾å‘³èª˜æƒ‘", 
            msg: "è¶Šä¾†è¶Šæ£’äº†ï¼ã€Œé»ƒç‡ˆé£Ÿç‰©ã€å¯ä»¥åƒï¼Œ\nä½†æ˜¯è¦æ§åˆ¶ä»½é‡ï¼Œå¶çˆ¾åƒå°±å¥½ï¼" 
        },
        { 
            targetScore: 600, 
            speed: 7, 
            title: "Level 3: æ¥µé€ŸæŒ‘æˆ°", 
            msg: "å¤ªå²å®³äº†ï¼è¨˜ä½çµ•å°è¦é¿é–‹ã€Œç´…ç‡ˆé£Ÿç‰©ã€ï¼Œ\nå®ƒå€‘æœƒè®“ä½ è®Šèƒ–è·‘ä¸å‹•å–”ï¼" 
        }
    ];

    // --- 3. éŠæˆ²åƒæ•¸ ---
    let score = 0;
    let currentLevel = 0; // 0 = Level 1, 1 = Level 2...
    let gameSpeed = 4;
    let frameCount = 0;
    let eatenRedFoods = []; 
    
    // éŠæˆ²ç‹€æ…‹ï¼š 'MENU', 'PLAYING', 'LEVEL_UP', 'GAMEOVER', 'WIN'
    let gameState = 'MENU'; 

    const player = {
        x: 60,
        y: 300,
        width: 50,
        height: 50,
        baseSize: 50,
        maxSize: 130, 
        color: '#2980b9',
        dy: 0,
        jumpPower: -13, 
        gravity: 0.5,   
        grounded: false,
        jumpCount: 0,   
        maxJumps: 2     
    };

    let foods = [];
    let effects = [];

    // --- 4. æ ¸å¿ƒé‚è¼¯ ---

    function spawnFood() {
        let rand = Math.random();
        let category, type, colorCode, lightName;

        if (rand < 0.35) { 
            type = greenList[Math.floor(Math.random() * greenList.length)];
            category = 'green';
            colorCode = '#27ae60';
            lightName = "ç¶ ç‡ˆ!è¡Œ";
        } else if (rand < 0.6) { 
            type = yellowList[Math.floor(Math.random() * yellowList.length)];
            category = 'yellow';
            colorCode = '#f39c12';
            lightName = "é»ƒç‡ˆ!";
        } else { 
            type = redList[Math.floor(Math.random() * redList.length)];
            category = 'red';
            colorCode = '#c0392b';
            lightName = "ç´…ç‡ˆ!åœ";
        }

        foods.push({
            x: canvas.width,
            y: 280 + Math.random() * 80, 
            size: 45,
            data: type,
            category: category,
            colorCode: colorCode,
            lightName: lightName,
            collected: false
        });
    }

    class FloatingText {
        constructor(text, x, y, color) {
            this.text = text;
            this.x = x;
            this.y = y;
            this.color = color;
            this.life = 40;
            this.dy = -1;
        }
        update() {
            this.y += this.dy;
            this.life--;
        }
        draw(ctx) {
            ctx.fillStyle = this.color;
            ctx.font = "bold 20px Microsoft JhengHei";
            ctx.strokeStyle = "white";
            ctx.lineWidth = 3;
            ctx.strokeText(this.text, this.x, this.y);
            ctx.fillText(this.text, this.x, this.y);
        }
    }

    // --- è¼¸å…¥æ§åˆ¶ ---
    function handleInput() {
        if (gameState === 'MENU') {
            startGame();
        } else if (gameState === 'GAMEOVER' || gameState === 'WIN') {
            resetGame();
        } else if (gameState === 'LEVEL_UP') {
            nextLevel(); // é€²å…¥ä¸‹ä¸€é—œ
        } else if (gameState === 'PLAYING') {
            if (player.grounded || player.jumpCount < player.maxJumps) {
                let fatPenalty = (player.width - player.baseSize) / 10; 
                let currentJump = player.jumpPower + (fatPenalty * 0.2);
                player.dy = currentJump;
                player.grounded = false;
                player.jumpCount++; 
            }
        }
    }

    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') handleInput();
    });
    canvas.addEventListener('mousedown', handleInput);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); });

    function startGame() {
        gameState = 'PLAYING';
        player.y = 300;
        updateLevelSettings();
    }

    function updateLevelSettings() {
        if (currentLevel < levelConfig.length) {
            gameSpeed = levelConfig[currentLevel].speed;
        }
    }

    function nextLevel() {
        currentLevel++;
        if (currentLevel >= levelConfig.length) {
            gameState = 'WIN'; // å…¨éƒ¨é€šé—œ
        } else {
            gameState = 'PLAYING';
            updateLevelSettings();
            // é‡ç½®é£Ÿç‰©ä½ç½®ï¼Œé¿å…ä¸€é–‹å§‹å°±æ’åˆ°
            foods = [];
        }
    }

    function update() {
        if (gameState !== 'PLAYING') return;

        player.dy += player.gravity;
        player.y += player.dy;

        let groundY = 400;
        if (player.y + player.height > groundY) {
            player.y = groundY - player.height;
            player.dy = 0;
            player.grounded = true;
            player.jumpCount = 0; 
        }

        frameCount++;
        // é€Ÿåº¦è¶Šå¿«ï¼Œé£Ÿç‰©ç”Ÿæˆé »ç‡ç¨å¾®åŠ å¿«ä¸€é»é»ï¼Œä¿æŒå¯†åº¦
        let spawnRate = Math.max(80, 120 - (currentLevel * 15));
        if (frameCount % spawnRate === 0) spawnFood();

        for (let i = 0; i < foods.length; i++) {
            let f = foods[i];
            f.x -= gameSpeed;

            let hitMargin = 12; 
            if (!f.collected && 
                player.x + hitMargin < f.x + f.size - hitMargin &&
                player.x + player.width - hitMargin > f.x + hitMargin &&
                player.y + hitMargin < f.y + f.size - hitMargin &&
                player.y + player.height - hitMargin > f.y + hitMargin) {
                
                f.collected = true;
                handleCollision(f);
            }
        }
        foods = foods.filter(f => f.x + f.size > -100);

        effects.forEach(e => e.update());
        effects = effects.filter(e => e.life > 0);

        // æª¢æŸ¥æ˜¯å¦å‡ç´š
        if (currentLevel < levelConfig.length) {
            if (score >= levelConfig[currentLevel].targetScore) {
                gameState = 'LEVEL_UP';
            }
        }
    }

    function handleCollision(food) {
        effects.push(new FloatingText(food.lightName, player.x, player.y - 20, food.colorCode));
        effects.push(new FloatingText(food.data.name, player.x, player.y - 50, "#333"));

        if (food.category === 'green') {
            score += 20;
            player.width -= 10; 
            player.height -= 10;
            if (player.width < player.baseSize) {
                player.width = player.baseSize;
                player.height = player.baseSize;
            }
        } else if (food.category === 'yellow') {
            score += 10;
        } else if (food.category === 'red') {
            score -= 5;
            player.width += 12; 
            player.height += 12;
            eatenRedFoods.push(food.data);
        }

        if (player.width >= player.maxSize) {
            gameState = 'GAMEOVER';
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // èƒŒæ™¯èˆ‡åœ°é¢
        ctx.fillStyle = '#7f8c8d';
        ctx.fillRect(0, 400, canvas.width, 50); 

        // æ°¸é ç¹ªè£½éŠæˆ²å…§å®¹èƒŒæ™¯ï¼Œé™¤éåœ¨ä¸»é¸å–®
        if (gameState !== 'MENU') {
            drawGameContent();
        }

        // ç¹ªè£½ UI é®ç½©å±¤
        if (gameState === 'MENU') {
            drawMenu();
        } else if (gameState === 'LEVEL_UP') {
            drawLevelUp();
        } else if (gameState === 'GAMEOVER') {
            drawGameOver();
        } else if (gameState === 'WIN') {
            drawWin();
        }
    }

    function drawMenu() {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.textAlign = 'center';
        
        ctx.fillStyle = '#333';
        ctx.font = 'bold 40px Microsoft JhengHei';
        ctx.fillText('è‚šå­å¥½é¤“...', canvas.width/2, 120);

        ctx.fillStyle = '#555';
        ctx.font = '24px Microsoft JhengHei';
        let lh = 35;
        ctx.fillText('å¯ä»¥å¹«æˆ‘é¸æ“‡å¥åº·çš„é£Ÿç‰©å—?', canvas.width/2, 180);
        ctx.fillText('æˆ‘ä¸æƒ³è¦åƒå¤ªå¤šç´…ç‡ˆé£Ÿç‰©ï¼Œ', canvas.width/2, 180 + lh);
        ctx.fillText('è¦ä¸ç„¶æˆ‘æœƒè·³ä¸å‹•...', canvas.width/2, 180 + lh * 2);

        ctx.fillStyle = '#e74c3c';
        ctx.font = 'bold 28px Microsoft JhengHei';
        ctx.fillText('é»æ“Šç•«é¢ é–‹å§‹é—–é—œ', canvas.width/2, 350);
        
        ctx.fillStyle = player.color;
        ctx.fillRect(canvas.width/2 - 25, 380, 50, 50);
    }

    function drawGameContent() {
        ctx.font = "30px Arial";
        ctx.textAlign = "center";
        foods.forEach(f => {
            if (f.collected) return;
            ctx.fillText(f.data.icon, f.x + f.size/2, f.y + f.size/2);
            ctx.fillStyle = "#333";
            ctx.font = "bold 14px Microsoft JhengHei";
            ctx.fillText(f.data.name, f.x + f.size/2, f.y + f.size + 15);
            ctx.font = "30px Arial";
        });

        ctx.fillStyle = player.color;
        if (player.width > player.baseSize * 1.4) ctx.fillStyle = '#e74c3c';
        ctx.fillRect(player.x, player.y, player.width, player.height);
        
        // çœ¼ç›
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(player.x + player.width*0.7, player.y + player.height*0.3, player.width*0.15, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(player.x + player.width*0.75, player.y + player.height*0.3, player.width*0.05, 0, Math.PI*2);
        ctx.fill();

        effects.forEach(e => e.draw(ctx));

        // é ‚éƒ¨ HUD
        ctx.fillStyle = '#333';
        ctx.textAlign = "left";
        ctx.font = "bold 20px Microsoft JhengHei";
        
        // é—œå¡é€²åº¦
        let levelData = levelConfig[currentLevel] || levelConfig[levelConfig.length-1];
        ctx.fillText(`Level ${currentLevel + 1}`, 20, 40);
        ctx.fillText(`åˆ†æ•¸: ${score} / ${levelData.targetScore}`, 140, 40);

        // é«”é‡æ¢
        let fatPercent = Math.round(((player.width - player.baseSize) / (player.maxSize - player.baseSize)) * 100);
        ctx.font = "16px Microsoft JhengHei";
        ctx.fillText(`è‚¥èƒ–åº¦: ${fatPercent}%`, 20, 75);
        ctx.fillStyle = "#ccc";
        ctx.fillRect(110, 60, 100, 15);
        ctx.fillStyle = fatPercent > 70 ? "red" : "green";
        ctx.fillRect(110, 60, fatPercent, 15);
    }

    function drawLevelUp() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // å½ˆçª—èƒŒæ™¯
        ctx.fillStyle = '#fff';
        ctx.strokeStyle = '#f1c40f';
        ctx.lineWidth = 5;
        let boxW = 500, boxH = 300;
        let boxX = (canvas.width - boxW)/2, boxY = (canvas.height - boxH)/2;
        ctx.fillRect(boxX, boxY, boxW, boxH);
        ctx.strokeRect(boxX, boxY, boxW, boxH);

        // æ–‡å­—
        ctx.textAlign = 'center';
        ctx.fillStyle = '#d35400';
        ctx.font = 'bold 36px Microsoft JhengHei';
        ctx.fillText('ğŸ‰ æ­å–œéé—œï¼', canvas.width/2, boxY + 60);

        // è¡›æ•™è¨Šæ¯
        ctx.fillStyle = '#333';
        ctx.font = '24px Microsoft JhengHei';
        let msg = levelConfig[currentLevel].msg.split('\n');
        for(let i=0; i<msg.length; i++) {
            ctx.fillText(msg[i], canvas.width/2, boxY + 130 + (i*35));
        }

        // æŒ‰éˆ•æç¤º
        ctx.fillStyle = '#2980b9';
        ctx.font = 'bold 24px Microsoft JhengHei';
        ctx.fillText('é»æ“Š æŒ‘æˆ°ä¸‹ä¸€é—œ â¡', canvas.width/2, boxY + 250);
    }

    function drawGameOver() {
        ctx.fillStyle = 'rgba(0,0,0,0.9)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.font = 'bold 36px Microsoft JhengHei';
        ctx.fillText('å¤ªé‡äº†ï¼è·³ä¸èµ·ä¾†å•¦ï¼', canvas.width/2, 80);
        
        ctx.font = '20px Microsoft JhengHei';
        ctx.fillStyle = '#ecf0f1';
        ctx.fillText(`æœ€çµ‚åˆ†æ•¸: ${score}`, canvas.width/2, 120);

        ctx.fillStyle = '#ff6b6b';
        ctx.fillText('å°±æ˜¯åƒäº†é€™äº›è®Šèƒ–çš„...', canvas.width/2, 160);
        
        let uniqueBadFoods = [...new Map(eatenRedFoods.map(item => [item['name'], item])).values()];
        let displayLimit = 5;
        let startX = canvas.width/2 - ((Math.min(uniqueBadFoods.length, displayLimit) * 70) / 2) + 35;
        
        ctx.font = "30px Arial";
        for(let i=0; i<uniqueBadFoods.length && i<displayLimit; i++) {
            let food = uniqueBadFoods[i];
            let xPos = startX + (i * 70);
            ctx.fillText(food.icon, xPos, 200);
            ctx.save();
            ctx.fillStyle = "#ccc";
            ctx.font = "14px Microsoft JhengHei";
            ctx.fillText(food.name, xPos, 230);
            ctx.restore();
        }

        ctx.fillStyle = '#f1c40f';
        ctx.font = 'bold 24px Microsoft JhengHei';
        ctx.fillText('é»æ“Šç•«é¢ é‡æ–°æŒ‘æˆ°', canvas.width/2, 350);
    }

    function drawWin() {
        ctx.fillStyle = 'rgba(0,0,0,0.85)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.textAlign = 'center';
        ctx.fillStyle = '#f1c40f';
        ctx.font = 'bold 48px Microsoft JhengHei';
        ctx.fillText('ğŸ† å¥åº·å¤§å¸«ï¼', canvas.width/2, 150);
        
        ctx.fillStyle = '#fff';
        ctx.font = '24px Microsoft JhengHei';
        ctx.fillText(`å¤ªå²å®³äº†ï¼ä½ å¾—äº† ${score} åˆ†`, canvas.width/2, 220);
        ctx.fillText('ä½ å·²ç¶“å­¸æœƒå¦‚ä½•é¸æ“‡é£Ÿç‰©å›‰ï¼', canvas.width/2, 260);

        ctx.fillStyle = '#2ecc71';
        ctx.font = 'bold 28px Microsoft JhengHei';
        ctx.fillText('é»æ“Šç•«é¢ å†ç©ä¸€æ¬¡', canvas.width/2, 350);
    }

    function resetGame() {
        score = 0;
        currentLevel = 0;
        player.width = player.baseSize;
        player.height = player.baseSize;
        player.y = 300;
        player.dy = 0;
        player.jumpCount = 0;
        foods = [];
        effects = [];
        eatenRedFoods = [];
        gameState = 'MENU'; 
        updateLevelSettings();
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    loop();

</script>
</body>
</html>